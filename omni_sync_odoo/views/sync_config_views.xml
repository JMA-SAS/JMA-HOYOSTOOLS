<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_omni_sync_config_form" model="ir.ui.view">
        <field name="name">omni.sync.config.form</field>
        <field name="model">omni.sync.config</field>
        <field name="arch" type="xml">
            <form>
                <!-- Campo requerido para modifiers -->
                <field name="active" invisible="1"/>

                <header>
                    <button name="test_connection" string="Probar Conexión"
                            type="object" class="btn-info" icon="fa-plug"
                            help="Verifica si los datos de acceso al servidor remoto son correctos."/>

                    <button name="update_stats" string="Actualizar Estadísticas"
                            type="object" class="btn-secondary" icon="fa-refresh"
                            help="Recalcula los contadores de sincronización mostrados en el tablero."/>
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_archive" type="object"
                                class="oe_stat_button" icon="fa-archive" invisible="not active">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Activo</span>
                            </div>
                        </button>

                        <button name="action_unarchive" type="object"
                                class="oe_stat_button" icon="fa-archive" invisible="active">
                            <div class="o_stat_info">
                                <span class="o_stat_text">Archivado</span>
                            </div>
                        </button>
                    </div>

                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"
                               string="Nombre de la Configuración"/>
                        <h1>
                            <field name="name"
                                   placeholder="Ej. Conexión Principal Odoo ERP"/>
                        </h1>
                    </div>

                    <!-- Panel de Estadísticas Vivas -->
                    <div class="row mt-4 mb-4"
                         style="background: #f8f9fa; padding: 20px; border-radius: 10px; border: 1px solid #dee2e6;">
                        <div class="col-md-2 text-center border-end">
                            <div style="font-size: 12px; color: #666; font-weight: bold; text-transform: uppercase;">Productos</div>
                            <div style="font-size: 24px; color: #007bff; font-weight: bold;">
                                <field name="total_synced_products" readonly="1"/>
                            </div>
                        </div>
                        <div class="col-md-2 text-center border-end">
                            <div style="font-size: 12px; color: #666; font-weight: bold; text-transform: uppercase;">Imágenes</div>
                            <div style="font-size: 24px; color: #28a745; font-weight: bold;">
                                <field name="total_synced_images" readonly="1"/>
                            </div>
                        </div>
                        <div class="col-md-2 text-center border-end">
                            <div style="font-size: 12px; color: #666; font-weight: bold; text-transform: uppercase;">Listas Precios</div>
                            <div style="font-size: 24px; color: #17a2b8; font-weight: bold;">
                                <field name="total_synced_pricelists" readonly="1"/>
                            </div>
                        </div>
                        <div class="col-md-2 text-center border-end">
                            <div style="font-size: 12px; color: #666; font-weight: bold; text-transform: uppercase;">Ventas</div>
                            <div style="font-size: 24px; color: #fd7e14; font-weight: bold;">
                                <field name="total_synced_sales" readonly="1"/>
                            </div>
                        </div>
                        <div class="col-md-2 text-center border-end">
                            <div style="font-size: 12px; color: #666; font-weight: bold; text-transform: uppercase;">Compras</div>
                            <div style="font-size: 24px; color: #6f42c1; font-weight: bold;">
                                <field name="total_synced_purchases" readonly="1"/>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div style="font-size: 12px; color: #666; font-weight: bold; text-transform: uppercase;">Última Sinc.</div>
                            <div style="font-size: 14px; color: #333; font-weight: bold; margin-top: 8px;">
                                <field name="last_sync_date" widget="remaining_days" readonly="1"/>
                            </div>
                        </div>
                    </div>

                    <group>
                        <group string="Credenciales de Acceso" icon="fa-lock">
                            <field name="remote_url" widget="url"/>
                            <field name="remote_database"/>
                            <field name="remote_username"/>
                            <field name="remote_password" password="1"/>
                        </group>
                        <group string="Módulos Activos" icon="fa-cubes">
                            <field name="sync_products" widget="boolean_toggle"/>
                            <field name="sync_images" widget="boolean_toggle"/>
                            <field name="sync_pricelists" widget="boolean_toggle"/>
                            <field name="sync_sales" widget="boolean_toggle"/>
                            <field name="sync_purchases" widget="boolean_toggle"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Configuración de Imágenes" icon="fa-image">
                            <group>
                                <group>
                                    <field name="brands_to_sync"/>
                                </group>
                                <group>
                                    <field name="batch_size"/>
                                    <field name="timeout"/>
                                </group>
                            </group>
                            <div class="alert alert-info" role="alert" style="margin-top: 10px;">
                                <i class="fa fa-info-circle"></i>
                                Use <strong>TOTAL</strong> para sincronizar todas las marcas disponibles en el origen.
                            </div>
                            <button name="action_sync_images_now" string="Ejecutar Sincronización de Imágenes"
                                    type="object" class="btn-primary" icon="fa-download"
                                    style="margin-top: 10px;"/>
                        </page>

                        <page string="Configuración de Compras" icon="fa-shopping-cart">
                            <group>
                                <field name="auto_confirm_po" widget="boolean_toggle"/>
                            </group>
                            <div class="alert alert-warning" role="alert" style="margin-top: 10px;">
                                <i class="fa fa-exclamation-triangle"></i>
                                Si activa la <strong>Confirmación Automática</strong>, las órdenes se confirmarán automáticamente.
                            </div>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_omni_sync_config_tree" model="ir.ui.view">
        <field name="name">omni.sync.config.tree</field>
        <field name="model">omni.sync.config</field>
        <field name="arch" type="xml">
            <tree decoration-info="active" decoration-muted="active == False">
                <field name="name"/>
                <field name="remote_url"/>
                <field name="sync_products" widget="boolean_toggle"/>
                <field name="sync_images" widget="boolean_toggle"/>
                <field name="sync_sales" widget="boolean_toggle"/>
                <field name="sync_purchases" widget="boolean_toggle"/>
                <field name="last_sync_date"/>
                <field name="active" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <record id="action_omni_sync_config" model="ir.actions.act_window">
        <field name="name">Parametrización de Conexiones</field>
        <field name="res_model">omni.sync.config</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Configura tu primera conexión remota.
            </p>
            <p>
                Aquí podrás definir las credenciales y qué módulos deseas sincronizar con otras instancias de Odoo.
            </p>
        </field>
    </record>
</odoo>
